<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Login</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/js-sha256@0.9.0/build/sha256.min.js"></script>

  <script>
    // SHA-256 해시 함수 (js-sha256 사용)
    function sha256Hash(message) {
      return sha256(message);  // js-sha256 라이브러리 사용
    }

    // 폼 제출 전에 비밀번호 해시
    async function handleSubmit(event) {
      event.preventDefault();  // 폼 기본 제출 방지

      const passwordField = document.getElementById('password');
      const passwordValue = passwordField.value;

      if (!passwordValue) {
        alert('Password is required!');
        return;
      }

      const hashedPassword = sha256Hash(passwordValue);  // SHA-256 해시 생성

      passwordField.value = hashedPassword;  // 해시된 비밀번호로 덮어쓰기

      // 이제 폼을 제출합니다.
      event.target.submit();
    }
  </script>
</head>
<body>
<div class="container">
  <h2>Login</h2>
  <form th:action="@{/login}" method="post" onsubmit="handleSubmit(event)"> <!-- 폼 제출 시 해시 함수 호출.. event는 submit 를 한 객체를 의미. event.type은 button 이고 event.target은 해당 form -->
    <div class="form-group">
      <label for="username">User ID:</label>
      <input type="text" class="form-control" id="username" name="username" required>
    </div>
    <div class="form-group">
      <label for="password">Password:</label>
      <input type="password" class="form-control" id="password" name="password" required>
    </div>
    <!-- CSRF 토큰을 자동으로 추가하는 부분 -->
    <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
    <button type="submit" class="btn btn-primary">Login</button>
  </form>
</div>
</body>
</html>